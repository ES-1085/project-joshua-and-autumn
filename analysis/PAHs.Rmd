---
title: 'GOM Contaminated Sediments analysis: PAHs'
author: "Joshua Harkness and Autumn Pauly"
date: "2023-10-28"
output: github_document
---

```{r load-packages}
library(tidyverse)
library(sf)
library(leaflet)
library(ggplot2)
library(RColorBrewer)
```

#Loading data
```{r load-data}
PAHs <- read.csv(paste0("/cloud/project/data/datasets_csv/PAHs_loc.csv"), header = T)
#PAHs <- PAHs_loc
```

#Glimpsing PAH
```{r glimpse-data, warning=FALSE}
glimpse(PAHs)
```

# Joining the Station Information to the PAH dataset
Joining the station data with the PAH sample taken. The dataset is pivoted so that each observation is the PAH that was observed.
```{r joining-station-info, warning=FALSE}
PAHs_station <- full_join(Station2002, PAHs, by = "UNIQUE_ID")

PAHs_station <- PAHs_station %>%
  mutate(CHRYSENE_C = as.numeric(CHRYSENE_C)) %>%
  pivot_longer(cols = `BENZNE_C`:`B_GHI_PYLC`, 
               names_to = "pah_detected", 
               values_to = "amount_detected")

PAHs_station = select(PAHs_station, c(UNIQUE_ID, LATITUDE.x, LONGITUDE.x, SOUNDING_M.x, QUAD_NAME.x, GEN_LOC_NM.x, SPECFC_LOC.x, AREA_CODE.x, SAMP_DATE1.x, TO_SMP_DT2.x, DPTH_N_COR.x, DPTH_CODE.x, COR_GRB_CD.x, site.x, pah_detected, amount_detected))

glimpse(PAHs_station)
```

# Plotting PAHs Detected in GOM
As shown in the plot below, there is a high concentration of Fluoranthene, followed by Pyrene, Chrysene, and Phenanthrene. 
``` {r plotting-pahs-detected, warning=FALSE}
PAHs_station %>%
  filter(pah_detected %in% c("BENZNE_C", "BENZNE_C", "NAPHTHLN_C", "BIPHENYL_C", "ACNPHTHN_C", "ACNPHTYL_C", "FLUORENE_C", "PHNANTHR_C", "ANTHRACN_C", "PYRENE_C", "FLORNTHN_C", "CHRYSENE_C", "PERYLENE_C")) %>%
  ggplot(aes(x = fct_rev(fct_reorder(pah_detected, amount_detected)), y = amount_detected, fill = pah_detected))+
  geom_col()+
  scale_fill_viridis_d() +
  theme_bw()+
  coord_flip()+
  theme(legend.position = "none")+
  labs(title = "PAHs Detected in Gulf of Maine Sediments",
       x = "PAH Detected",
       y = "Amount Detected")
```

The table below is visualizing the mean, standard deviation, count, and principal square root values of PAH concentrations for the general locations. 

As shown below, Mass Bays (8505) has the higest count of PAHs, followed by Northwest Boston Harbor (4243) and Gulf of Maine (>50m Isobath) (1953). This does not suggest that these locations will have the highest concentrations of PAHs, as this does not reflect the quantity of PAHs collected. Boston Inner Harbor (1843.90) has the highest mean PAH concentration, followed by Northwest Boston Harbor (610.55) and Central Boston Harbor (502.36). In addition to this, Boston Inner Harbor has the highest standard deviation (14235.68), followed by Northwest Boston Harbor (3132.97) and "43.5N to 44N; to 50M isobath" (1842.51). 
``` {r summary-stats-PAHs}
Summary_PAHs <- PAHs_station %>%
  group_by(GEN_LOC_NM.x) %>%
  drop_na(amount_detected) %>%
  summarise(mean_PAH = mean(amount_detected),
    sd_PAH = sd(amount_detected),
    n_PAH = n(),
    SE_PAH = sd(amount_detected) / sqrt(n()))

Summary_PAHs
```

The graph below is showing which site has the highest mean PAH concentrations in the Gulf of Maine. As shown, the site with the highest PAH concentration is Boston Inner Harbor, followed by Northwest Boston Harbor, Central Boston Harbor, and the area between 43.5N and 44N (Cape Elizabeth to Rockland, ME). 
```{r pah-gen-loc}
Summary_PAHs %>%
  ggplot(aes(x = fct_rev(fct_reorder(GEN_LOC_NM.x, mean_PAH)), y = mean_PAH, fill = GEN_LOC_NM.x))+
  geom_col(col = "black")+
  geom_errorbar(aes(ymin = mean_PAH - SE_PAH, ymax = mean_PAH + SE_PAH), width = 0.2)+
  coord_flip()+
  scale_fill_viridis_d()+
  theme_bw()+
  theme(legend.position = "none")+
  labs(title = "PAH Concentrations in Gulf of Maine Sediments",
       x = "General location",
       y = "Mean total PAH concentration ng/g",
       caption = "Error bars = 1 standard error")
```

### Specific Locations
The plot below visualizes the summary of PAHs found at each location, including the mean, standard deviation, count, and principal square root.
```{r sum-pah-site}
Sum_PAH_site <- PAHs_station %>%
  group_by(GEN_LOC_NM.x) %>%
  drop_na(amount_detected) %>%
  summarise(mean_PAH = mean(amount_detected),
    sd_PAH = sd(amount_detected),
    n_PAH = n(),
    SE_PAH = sd(amount_detected) / sqrt(n()))

Sum_PAH_site

```

This plot shows us the exact quantity of PAH found at each site. 
```{r summarize-by-site}
PAHs_station %>%
  group_by(GEN_LOC_NM.x, pah_detected) %>%
  summarise(amount_detected = sum(amount_detected, na.rm = TRUE)) %>%
  arrange(desc(amount_detected))
```

## Boston Inner Harbor Concentrations
This plot visualizes the specific PAHs present in Boston Inner Harbor. 
As shown in the plot, Chrysene (569,679.08 ng/g) has the highest concentration in the harbor. This is followed by Benz(a) anthracene (508889.40 ng/g), Pyrene (346679.56 ng/g), and Fluoranthene (319594.32 ng/g) 
```{r sum-organics-boston-inner-harbor}
PAHs_station %>%
  group_by(GEN_LOC_NM.x, pah_detected) %>%
  summarise(amount_detected = sum(amount_detected, na.rm = TRUE)) %>%
  filter(GEN_LOC_NM.x == "BOSTON INNER HARBOR") %>%
  arrange(desc(amount_detected))

PAHs_station %>%
  group_by(GEN_LOC_NM.x, pah_detected) %>%
  summarise(amount_detected = sum(amount_detected, na.rm = TRUE)) %>%
  filter(GEN_LOC_NM.x == "BOSTON INNER HARBOR") %>%
 ggplot(aes(x = fct_rev(fct_reorder(pah_detected, amount_detected)), y = amount_detected, fill = pah_detected))+
  geom_col()+
  coord_flip()+
  theme(legend.position = "none")+
  labs(title = "PAH Concentrations in Boston Inner Harbor",
       x = "PAH Detected",
       y = "Amount Detected (ng/g)")
```

## Northwest Boston Harbor Concentrations
This plot visualizes the specific PAHs present in Northwest Boston Harbor.  
As shown in the plot, Pyrene (315,904.49 ng/g) has the highest concentration in the harbor. This is followed by Fluoranthene (312,942.98 ng/g), Phenanthrene (219061.23 ng/g), and Chrysene (200784.37 ng/g).
```{r type_of_organic-in-northwest-boston-harbor, warning = FALSE}
PAHs_station %>%
  group_by(GEN_LOC_NM.x, pah_detected) %>%
  summarise(amount_detected = sum(amount_detected, na.rm = TRUE)) %>%
  filter(GEN_LOC_NM.x == "NORTHWEST BOSTON HARBOR") %>%
  arrange(desc(amount_detected))

PAHs_station %>%
  drop_na(amount_detected) %>%
  filter(GEN_LOC_NM.x %in% c("NORTHWEST BOSTON HARBOR")) %>%
  ggplot(aes(x = fct_rev(fct_reorder(pah_detected, amount_detected)), y = amount_detected, fill = pah_detected))+
  geom_col()+
  coord_flip()+
  theme(legend.position = "none")+
  labs(title = "PAH Concentrations in Northwest Boston Harbor",
       x = "PAH Detected",
       y = "Amount Detected (ng/g)")
```

## Cape Ann to Cape Elizabeth Concentrations
This plot visualizes the specific PAHs present from Cape Ann to Cape Elizabeth.  
As shown in the plot, Fluoranthene (116,706.13 ng/g) has the highest concentration in the harbor. Chrysene (112,928.05 ng/g) and Pyrene	(110687.93 ng/g) are the second and third most abundant PAHs. 
```{r type_of_organic-in-BOSTON-INNER-HARBOR, warning = FALSE}
PAHs_station %>%
  group_by(GEN_LOC_NM.x, pah_detected) %>%
  summarise(amount_detected = sum(amount_detected, na.rm = TRUE)) %>%
  filter(GEN_LOC_NM.x == "43.5N to 44N; to 50M isobath") %>%
  arrange(desc(amount_detected))

PAHs_station %>%
  drop_na(amount_detected) %>%
  filter(GEN_LOC_NM.x %in% c("43.5N to 44N; to 50M isobath")) %>%
 ggplot(aes(x = fct_rev(fct_reorder(pah_detected, amount_detected)), y = amount_detected, fill = pah_detected))+
  geom_col()+
  coord_flip()+
  theme(legend.position = "none")+
  labs(title = "PAH Concentrations from Cape Ann to Cape Elizabeth",
       x = "PAH Detected",
       y = "Amount Detected (ng/g)")
```

``` {r sum-organics-boston-inner-harbor}
PAHs_station %>%
  group_by(GEN_LOC_NM.x, pah_detected) %>%
  summarise(amount_detected = sum(amount_detected, na.rm = TRUE)) %>%
  filter(GEN_LOC_NM.x == "BOSTON INNER HARBOR") %>%
  arrange(desc(amount_detected))
```

## Summarizing by River

``` {r pah-concentrations-in-me-rivers}
Sum_PAH_site %>% 
  filter(site.x %in% c("Kennebunk River", "MYSTIC RIVER", "Mystic Rvr, red nun 4", "Neponset River", "Neponset River mouth", "Portland Fore River", "Royal River", "Weymouth Back River", "York River", "Weymouth Fore River", "Weymouth Fore Rvr", "Piscataqua River N of Pierce Is.", "NORTH RIVER", "Neponset River Bridge", "Charles River")) %>%
  ggplot(aes(x = site.x, y = mean_PAH, fill = site.x))+
  geom_col()+
  scale_fill_viridis_d()  +
  theme_bw()+
  coord_flip()+
  labs(title = "PAH Concentrations in Maine Rivers",
       subtitle = "Union River excluded",
       x = "Location",
       y = "Mean total PAH concentration ng/g", 
       fill = "Site")


```

## Statistical tests
### Difference between general locations

Does total PAH concentration differ significantly between general locations?

```{r}
hist(PAHs_station$amount_detected)
```

```{r}
kw1=kruskal.test(PAHs_station$amount_detected ~ PAHs_station$GEN_LOC_NM.x)
kw1
```
This shows that it is significant. We will now run a Dunn post-hoc test to identify any significance between locations.
```{r}
#install.packages("dunn.test")
library(dunn.test)

dunn=dunn.test(PAHs_station$amount_detected,Organics$GEN_LOC_NM.x,method="bh")

```
Interpretation: Most general locations have significantly different mean total PAH concentrations.

## Map Plots
### Static maps
```{r load-GOM_states-shp}
GOM_states <- st_read("/cloud/project/extra/GOM_DD.shp")
```

```{r load-bathy-shp}
Bathy <- st_read("/cloud/project/extra/BATHYMGM_ARC.shp")
```
Bathymetry data is in projected coordinate system (NAD83), other data is geodetic (NAD83).  
Wasn't able to add this layer to map plot -- need to change projection.

```{r bathy-to-NAD83-format}
st_crs(Bathy)
Bathy <- st_transform(Bathy, "+init=epsg:4269")
```
Now the Bathy shapefile is in geodetic NAD83 format.

```{r unique-bathy}
unique(Bathy$CONTOUR)
```

```{r plot-bathy}
Bathy_low_res <- Bathy%>%
 filter(CONTOUR %in% c("-100","-500","-1000","-2000","-3000","-4000"))
ggplot(Bathy_low_res) +
  geom_sf(aes())
```
```{r creating-Bathy_hi_res-pah}
Bathy_hi_res <- Bathy%>%
 filter(CONTOUR %in% c("-40","-80","-120","160","200","240"))
ggplot(Bathy_hi_res) +
  geom_sf(aes())
```

```{r drop-na-pah}
PAH_no_na <- PAHs_station %>%
  drop_na(amount_detected)

PAH_no_na_specific_pah <- PAH_no_na %>%
  filter(pah_detected %in% c("BENZNE_C", "BENZNE_C", "NAPHTHLN_C", "BIPHENYL_C", "ACNPHTHN_C", "ACNPHTYL_C", "FLUORENE_C", "PHNANTHR_C", "ANTHRACN_C", "PYRENE_C", "FLORNTHN_C", "CHRYSENE_C", "PERYLENE_C"))

```


```{r pah-gom-map-plot, warning = FALSE}
ggplot(GOM_states)+
  geom_sf(aes())+
  geom_sf(data = Bathy_low_res, color = "gray80", width = 1)+
  geom_point(data = PAH_no_na, (aes(x = LONGITUDE.x, y = LATITUDE.x, size = amount_detected, alpha = 0.5)))+
  xlim(-72,-65)+
  ylim(40,45)+
  theme_bw()+
  labs(title = "Distribution and concentration of PAHs",
       subtitle ="Gulf of Maine sediments",
       x = "Longitude",
       y = "Latitude")+
  guides(size = guide_legend(title = "PAH ng/g"))+
  guides(alpha = FALSE)+
  ggspatial::annotation_scale(
    location = "bl",
    bar_cols = c("grey60", "white"),
    text_family = "ArcherPro Book"
  ) +
  ggspatial::annotation_north_arrow(
    location = "tr", which_north = "true",
    pad_x = unit(0, "in"), pad_y = unit(0.2, "in"),
    style = ggspatial::north_arrow_nautical(
      fill = c("grey40", "white"),
      line_col = "grey20",
      text_family = "ArcherPro Book"))
```
Above is the Distribution and concentration of PAHs in the Gulf of Maine sediments. 

```{r MDI-area-map-pah}
ggplot(GOM_states)+
  geom_sf(aes())+
  geom_sf(data = Bathy_hi_res, color = "gray80", width = 1)+
  geom_point(data=PAH_no_na, (aes(x = LONGITUDE.x, y = LATITUDE.x, size = amount_detected, alpha = 0.5)))+
  xlim(-69.2,-68)+
  ylim(44,44.5)+
  theme_bw()+
  labs(title = "Distribution and concentration of PAHs",
       subtitle ="MDI and Penobscot Bay sediments",
       x = "Longitude",
       y = "Latitude")+
  guides(size = guide_legend(title = "PAH ng/g"))+
  guides(alpha = FALSE)+
  ggspatial::annotation_scale(
    location = "bl",
    bar_cols = c("grey60", "white"),
    text_family = "ArcherPro Book"
  ) +
  ggspatial::annotation_north_arrow(
    location = "tr", which_north = "true",
    pad_x = unit(0, "in"), pad_y = unit(0.2, "in"),
    style = ggspatial::north_arrow_nautical(
      fill = c("grey40", "white"),
      line_col = "grey20",
      text_family = "ArcherPro Book"))
```
Above is the Distribution and concentration of PAHs in MDI and Penobscot Bay sediments. 

```{r boston-and-ma-area-map-pah}
ggplot(GOM_states)+
  geom_sf(aes())+
  geom_sf(data = Bathy_hi_res, color = "gray80", width = 1)+
  geom_point(data=PAH_no_na, (aes(x = LONGITUDE.x, y = LATITUDE.x, size = amount_detected, alpha = 0.5)))+
  xlim(-71.2,-69.5)+
  ylim(41.8,43)+
  theme_bw()+
  labs(title = "Distribution and concentration of PAHs",
       subtitle ="Boston, MA and Cape Cod Bay sediments",
       x = "Longitude",
       y = "Latitude")+
  guides(size = guide_legend(title = "PAH ng/g"))+
  guides(alpha = FALSE)+
  ggspatial::annotation_scale(
    location = "bl",
    bar_cols = c("grey60", "white"),
    text_family = "ArcherPro Book"
  ) +
  ggspatial::annotation_north_arrow(
    location = "tr", which_north = "true",
    pad_x = unit(0, "in"), pad_y = unit(0.1, "in"),
    style = ggspatial::north_arrow_nautical(
      fill = c("grey40", "white"),
      line_col = "grey20",
      text_family = "ArcherPro Book"))
```
Above is the Distribution and concentration of PAHs in Boston, MA and Cape Cod Bay sediments. 

```{r boston-and-ma-area-map-pah}
ggplot(GOM_states)+
  geom_sf(aes())+
  geom_sf(data = Bathy_hi_res, color = "gray80", width = 1)+
  geom_point(data=PAH_no_na_specific_pah, (aes(x = LONGITUDE.x, y = LATITUDE.x, size = amount_detected, color = pah_detected, alpha = 0.5)))+
  xlim(-71.2,-69.5)+
  ylim(41.8,43)+
  theme_bw()+
  labs(title = "Distribution and concentration of PAHs",
       subtitle ="Boston, MA and Cape Cod Bay sediments",
       x = "Longitude",
       y = "Latitude")+
  guides(size = guide_legend(title = "PAH ng/g"))+
  guides(alpha = FALSE)+
  ggspatial::annotation_scale(
    location = "bl",
    bar_cols = c("grey60", "white"),
    text_family = "ArcherPro Book"
  ) +
  ggspatial::annotation_north_arrow(
    location = "tr", which_north = "true",
    pad_x = unit(0, "in"), pad_y = unit(0.1, "in"),
    style = ggspatial::north_arrow_nautical(
      fill = c("grey40", "white"),
      line_col = "grey20",
      text_family = "ArcherPro Book"))
```
Above is the same graph, but now we are coloring the points by the specific pah that was detected. 

### Interactive map

```{r create-html-labels-pah}
#labels <- sprintf("<strong>%s</strong><br/>%g ng/g", 
#                 PAH_no_na$SPECFC_LOC.x, PAH_no_na$amount_detected) %>%
# lapply(htmltools::HTML)
#
#head(labels, 1)
```

```{r leaflet-map-pcb}
#leaflet(data = PAH_no_na) %>%
  #addProviderTiles(providers$Esri.WorldTopoMap) %>%
  #setView(lng = -68.5, 
    #      lat = 43.5, 
     #     zoom = 6) %>%
  #addCircleMarkers(lng = ~LONGITUDE.x, lat = ~LATITUDE.x, popup = c(~SPECFC_LOC.x, ~amount_detected), label = labels)
```

Note that the two above code chunks are commented out as .rmd will not knit to github document with html functions.  Uncomment to run and change output type to `html_document` to knit.


